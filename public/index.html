<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Realtime Spreadsheet</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/luckysheet@2.1.13/dist/plugins/css/plugins.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/luckysheet@2.1.13/dist/plugins/css/pluginsCss.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/luckysheet@2.1.13/dist/css/luckysheet.css" />
    <link rel="stylesheet" href="/styles.css" />
  </head>
  <body>
    <div class="app-root">
      <!-- Minimal bar: when logged in but NOT in sheet view (Home, My Sheets, etc.) -->
      <header class="minimal-bar" id="minimal-bar">
        <a href="#" class="app-brand" id="logo-link">Realtime Sheet</a>
        <div class="minimal-bar-right">
          <span id="minimal-user-name" class="app-user-name"></span>
          <button type="button" id="minimal-logout-btn" class="app-btn-text">Logout</button>
        </div>
      </header>

      <!-- Sheet view: Google Sheets-style layout -->
      <div class="gs-sheet-ui sheet-only-ui" id="gs-sheet-ui">
        <!-- Top bar: icon, doc title, star, folder, saved status | clock, comment, Share, avatar -->
        <header class="gs-top-bar">
          <div class="gs-top-bar-left">
            <button type="button" id="sidebar-toggle" class="gs-icon-btn" title="Menu" aria-label="Menu">‚ò∞</button>
            <a href="#" class="gs-app-icon" id="logo-link-sheet" title="Home">üìä</a>
            <span id="gs-doc-title" class="gs-doc-title" contenteditable="true" title="Document name"></span>
            <button type="button" class="gs-icon-btn" id="gs-star-btn" title="Star">‚òÖ</button>
            <button type="button" class="gs-icon-btn" id="gs-folder-btn" title="Move to folder">üìÅ</button>
            <span id="gs-save-status" class="gs-save-status">Saved</span>
          </div>
          <div class="gs-top-bar-right">
            <button type="button" class="gs-icon-btn" id="gs-history-btn" title="Version history">üïê</button>
            <button type="button" class="gs-icon-btn" id="gs-comment-btn" title="Comments">üí¨</button>
            <button type="button" class="gs-btn-share" id="header-share-btn">Share</button>
            <div class="gs-user-avatar" id="top-user-avatar"></div>
            <span id="top-user-name" class="app-user-name"></span>
            <button type="button" id="top-logout-btn" class="app-btn-text">Logout</button>
          </div>
        </header>

        <!-- Menu bar: File, Edit, View, Insert, Format, Data, Tools, Extensions, Help -->
        <nav class="gs-menu-bar">
          <button type="button" class="gs-menu-item" data-menu="file">File</button>
          <button type="button" class="gs-menu-item" data-menu="edit">Edit</button>
          <button type="button" class="gs-menu-item" data-menu="view">View</button>
          <button type="button" class="gs-menu-item" data-menu="insert">Insert</button>
          <button type="button" class="gs-menu-item" data-menu="format">Format</button>
          <button type="button" class="gs-menu-item" data-menu="data">Data</button>
          <button type="button" class="gs-menu-item" data-menu="tools">Tools</button>
          <button type="button" class="gs-menu-item" data-menu="extensions">Extensions</button>
          <button type="button" class="gs-menu-item" data-menu="help">Help</button>
        </nav>

        <!-- Toolbar / Ribbon (all implemented; no placeholders) -->
        <div class="gs-ribbon">
          <div class="gs-ribbon-row">
            <div class="gs-ribbon-group">
              <select class="gs-ribbon-select gs-font-size" id="toolbar-size" title="Font size"><option>8</option><option>9</option><option selected>10</option><option>11</option><option>12</option><option>14</option></select>
              <button type="button" class="gs-ribbon-btn" id="toolbar-bold" title="Bold"><b>B</b></button>
              <button type="button" class="gs-ribbon-btn" id="toolbar-italic" title="Italic"><i>I</i></button>
              <button type="button" class="gs-ribbon-btn" id="toolbar-underline" title="Underline"><u>U</u></button>
              <button type="button" class="gs-ribbon-btn" id="toolbar-strike" title="Strikethrough">SÃ∂</button>
              <button type="button" class="gs-ribbon-btn" id="toolbar-merge" title="Merge cells">Merge</button>
            </div>
            <div class="gs-ribbon-group">
              <button type="button" class="gs-ribbon-btn" id="toolbar-align-left" title="Align left">‚â°</button>
              <button type="button" class="gs-ribbon-btn" id="toolbar-align-center" title="Align center">‚â°</button>
              <button type="button" class="gs-ribbon-btn" id="toolbar-align-right" title="Align right">‚â°</button>
              <button type="button" class="gs-ribbon-btn" id="toolbar-valign" title="Vertical align">‚äü</button>
            </div>
            <div class="gs-ribbon-group">
              <button type="button" class="gs-ribbon-btn" id="toolbar-sum" title="Sum selection">Œ£</button>
            </div>
          </div>
        </div>

        <!-- File menu dropdown -->
        <div class="gs-menu-dropdowns" id="gs-menu-dropdowns">
          <div class="gs-menu-dropdown" id="dropdown-file">
            <div class="gs-menu-dropdown-item" data-action="new-sheet">New</div>
            <div class="gs-menu-dropdown-divider"></div>
            <div class="gs-menu-dropdown-item" data-action="permissions">Share</div>
            <div class="gs-menu-dropdown-item" data-action="history">Undo</div>
            <div class="gs-menu-dropdown-item" data-action="export">Redo</div>
            <div class="gs-menu-dropdown-divider"></div>
            <div class="gs-menu-dropdown-item" data-action="print">Print</div>
          </div>
        </div>
      </div>

      <main class="sheet-canvas">
        <section id="view-login" class="canvas-view">
          <div class="login-card">
            <h2>Sign in</h2>
            <form id="login-form">
              <label>Username <input type="text" id="login-username" required /></label>
              <label>Password <input type="password" id="login-password" required /></label>
              <button type="submit">Login</button>
              <p class="text-hint">Default: <code>admin</code> / <code>admin123</code></p>
              <p id="login-error" class="text-error"></p>
            </form>
          </div>
        </section>

        <section id="view-home" class="canvas-view hidden">
          <div class="canvas-inner">
            <h1 class="canvas-title">Home</h1>
            <button type="button" id="home-create-sheet-btn" class="btn-primary">Create new spreadsheet</button>
            <div class="home-section">
              <h2>Recent</h2>
              <ul id="home-recent-sheets" class="sheet-list"></ul>
            </div>
            <div class="home-section">
              <h2>Shared with me</h2>
              <ul id="home-shared-sheets" class="sheet-list"></ul>
            </div>
          </div>
        </section>

        <section id="view-my-sheets" class="canvas-view hidden">
          <div class="canvas-inner">
            <h1 class="canvas-title">My Sheets</h1>
            <button type="button" id="my-create-sheet-btn" class="btn-primary">Create new spreadsheet</button>
            <table class="data-table">
              <thead><tr><th>Name</th><th>Updated</th><th>Permission</th><th></th></tr></thead>
              <tbody id="my-sheets-table-body"></tbody>
            </table>
          </div>
        </section>

        <section id="view-shared-sheets" class="canvas-view hidden">
          <div class="canvas-inner">
            <h1 class="canvas-title">Shared Sheets</h1>
            <table class="data-table">
              <thead><tr><th>Name</th><th>Owner</th><th>Permission</th><th>Updated</th><th></th></tr></thead>
              <tbody id="shared-sheets-table-body"></tbody>
            </table>
          </div>
        </section>

        <section id="view-users" class="canvas-view hidden">
          <div class="canvas-inner">
            <h1 class="canvas-title">User Management</h1>
            <div class="user-create-row">
              <input type="text" id="um-username" placeholder="Username" />
              <input type="password" id="um-password" placeholder="Password" />
              <select id="um-role"><option value="leader">Leader</option><option value="user">User</option></select>
              <button type="button" id="um-create-btn" class="btn-primary">Create user</button>
            </div>
            <p id="um-message" class="text-info"></p>
            <table class="data-table">
              <thead><tr><th>Username</th><th>Role</th><th>Created by</th><th></th></tr></thead>
              <tbody id="um-table-body"></tbody>
            </table>
          </div>
        </section>

        <section id="view-settings" class="canvas-view hidden">
          <div class="canvas-inner">
            <h1 class="canvas-title">Settings</h1>
            <p class="text-hint">Profile and app settings.</p>
          </div>
        </section>

        <section id="view-sheet" class="canvas-view hidden">
          <div class="gs-formula-bar">
            <span id="current-cell-ref" class="gs-cell-ref">A1</span>
            <span class="gs-formula-fx">fx</span>
            <input type="text" class="gs-formula-input" id="formula-input" placeholder="Enter formula or value" readonly />
          </div>
          <div class="grid-container">
            <div id="luckysheet" class="luckysheet-wrap"></div>
          </div>
        </section>
      </main>
    </div>

    <div id="sidebar-overlay" class="overlay-sidebar">
      <div id="sidebar-backdrop" class="sidebar-backdrop"></div>
      <aside id="sidebar" class="sidebar-panel">
        <nav class="sidebar-nav">
          <button type="button" class="sidebar-nav-item" data-view="home" id="nav-home"><span>Home</span></button>
          <button type="button" class="sidebar-nav-item" data-view="my-sheets" id="nav-my-sheets"><span>My Sheets</span></button>
          <button type="button" class="sidebar-nav-item" data-view="shared-sheets" id="nav-shared-sheets"><span>Shared Sheets</span></button>
          <button type="button" class="sidebar-nav-item" data-view="users" id="nav-users" style="display:none"><span>User Management</span></button>
          <button type="button" class="sidebar-nav-item" data-view="settings" id="nav-settings"><span>Settings</span></button>
        </nav>
      </aside>
    </div>

    <!-- Sheet tab context menu (rename, duplicate, delete, move) -->
    <div id="sheet-tab-context-menu" class="gs-context-menu hidden">
      <div class="gs-context-item" data-tab-action="rename">Rename</div>
      <div class="gs-context-item" data-tab-action="duplicate">Duplicate</div>
      <div class="gs-context-item" data-tab-action="delete">Delete</div>
      <div class="gs-context-item" data-tab-action="move-left">Move left</div>
      <div class="gs-context-item" data-tab-action="move-right">Move right</div>
    </div>

    <!-- List all sheets (tabs) in this document -->
    <div id="sheet-tabs-list-modal" class="modal hidden">
      <div class="modal-backdrop" id="sheet-tabs-list-backdrop"></div>
      <div class="modal-dialog gs-tabs-list-dialog">
        <h3>Sheets in this spreadsheet</h3>
        <ul id="sheet-tabs-list-modal-ul"></ul>
        <div class="modal-actions">
          <button type="button" class="app-btn-text" id="sheet-tabs-list-close">Close</button>
        </div>
      </div>
    </div>

    <div id="share-modal" class="modal hidden">
      <div class="modal-backdrop"></div>
      <div class="modal-dialog">
        <h3>Share</h3>
        <form id="share-form">
          <label>User <select id="share-user-id"><option value="">Select user</option></select></label>
          <label>Role <select id="share-role"><option value="editor">Editor</option><option value="viewer">Viewer</option></select></label>
          <p id="share-message" class="text-info"></p>
          <div class="modal-actions">
            <button type="button" class="app-btn-text" id="share-cancel">Cancel</button>
            <button type="submit" class="btn-primary">Share</button>
          </div>
        </form>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/luckysheet@2.1.13/dist/plugins/js/plugin.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/luckysheet@2.1.13/dist/luckysheet.umd.js"></script>
    <script src="https://cdn.socket.io/4.8.1/socket.io.min.js"></script>
    <script src="/toolbarCommands.js"></script>
    <script src="/app.js"></script>
  </body>
</html>
